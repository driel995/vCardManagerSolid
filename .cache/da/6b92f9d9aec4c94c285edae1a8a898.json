{"id":"mo03","dependencies":[{"name":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\Session.js.map","includedInParent":true,"mtime":1671123281648},{"name":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\src\\Session.ts","includedInParent":true,"mtime":1671123281725},{"name":"C:\\Users\\39351\\Progetti\\SolidProject\\package.json","includedInParent":true,"mtime":1671127455006},{"name":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\package.json","includedInParent":true,"mtime":1671123281699},{"name":"events","loc":{"line":4,"column":25,"index":162},"parent":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\Session.js","resolved":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\events\\events.js"},{"name":"@inrupt/solid-client-authn-core","loc":{"line":5,"column":42,"index":216},"parent":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\Session.js","resolved":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\index.mjs"},{"name":"uuid","loc":{"line":6,"column":23,"index":276},"parent":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\Session.js","resolved":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\uuid\\dist\\esm-browser\\index.js"},{"name":"./dependencies","loc":{"line":7,"column":31,"index":317},"parent":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\Session.js","resolved":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\dependencies.js"},{"name":"./constant","loc":{"line":8,"column":27,"index":364},"parent":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\Session.js","resolved":"C:\\Users\\39351\\Progetti\\SolidProject\\node_modules\\@inrupt\\solid-client-authn-browser\\dist\\constant.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.Session=exports.silentlyAuthenticate=void 0;const e=require(\"events\"),t=require(\"@inrupt/solid-client-authn-core\"),n=require(\"uuid\"),i=require(\"./dependencies\"),o=require(\"./constant\");async function s(e,t,n){var i;const s=await t.validateCurrentSession(e);return null!==s&&(window.localStorage.setItem(o.KEY_CURRENT_URL,window.location.href),await t.login({sessionId:e,prompt:\"none\",oidcIssuer:s.issuer,redirectUrl:s.redirectUrl,clientId:s.clientAppId,clientSecret:s.clientAppSecret,tokenType:null!==(i=s.tokenType)&&void 0!==i?i:\"DPoP\"},n),!0)}function r(e){return!!(null==e?void 0:e.isLoggedIn)}exports.silentlyAuthenticate=s;class c extends e.EventEmitter{constructor(){var e;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;super(),e=this,this.tokenRequestInProgress=!1,this.login=(async e=>{var t;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...e,tokenType:null!==(t=e.tokenType)&&void 0!==t?t:\"DPoP\"},this),new Promise(()=>{})}),this.fetch=(async(e,t)=>this.clientAuthentication.fetch(e,t)),this.internalLogout=(async e=>{window.localStorage.removeItem(o.KEY_CURRENT_SESSION),await this.clientAuthentication.logout(this.info.sessionId),this.info.isLoggedIn=!1,e&&this.emit(t.EVENTS.LOGOUT)}),this.logout=(async()=>this.internalLogout(!0)),this.handleIncomingRedirect=async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var i;if(e.info.isLoggedIn)return e.info;if(e.tokenRequestInProgress)return;const c=\"string\"==typeof n?{url:n}:n,l=null!==(i=c.url)&&void 0!==i?i:window.location.href;e.tokenRequestInProgress=!0;const a=await e.clientAuthentication.handleIncomingRedirect(l,e);if(r(a)){e.setSessionInfo(a);const n=window.localStorage.getItem(o.KEY_CURRENT_URL);null===n?e.emit(t.EVENTS.LOGIN):(window.localStorage.removeItem(o.KEY_CURRENT_URL),e.emit(t.EVENTS.SESSION_RESTORED,n))}else if(!0===c.restorePreviousSession){const t=window.localStorage.getItem(o.KEY_CURRENT_SESSION);if(null!==t){if(await s(t,e.clientAuthentication,e))return new Promise(()=>{})}}return e.tokenRequestInProgress=!1,a},c.clientAuthentication?this.clientAuthentication=c.clientAuthentication:c.secureStorage&&c.insecureStorage?this.clientAuthentication=(0,i.getClientAuthenticationWithDependencies)({secureStorage:c.secureStorage,insecureStorage:c.insecureStorage}):this.clientAuthentication=(0,i.getClientAuthenticationWithDependencies)({}),c.sessionInfo?this.info={sessionId:c.sessionInfo.sessionId,isLoggedIn:!1,webId:c.sessionInfo.webId}:this.info={sessionId:null!=l?l:(0,n.v4)(),isLoggedIn:!1},this.on(t.EVENTS.LOGIN,()=>window.localStorage.setItem(o.KEY_CURRENT_SESSION,this.info.sessionId)),this.on(t.EVENTS.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.on(t.EVENTS.ERROR,()=>this.internalLogout(!1))}onLogin(e){this.on(t.EVENTS.LOGIN,e)}onLogout(e){this.on(t.EVENTS.LOGOUT,e)}onError(e){this.on(t.EVENTS.ERROR,e)}onSessionRestore(e){this.on(t.EVENTS.SESSION_RESTORED,e)}onSessionExpiration(e){this.on(t.EVENTS.SESSION_EXPIRED,e)}setSessionInfo(e){this.info.isLoggedIn=e.isLoggedIn,this.info.webId=e.webId,this.info.sessionId=e.sessionId,this.info.expirationDate=e.expirationDate,this.on(t.EVENTS.SESSION_EXTENDED,e=>{this.info.expirationDate=Date.now()+1e3*e})}}exports.Session=c;"},"sourceMaps":{"js":{"mappings":[{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":0}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":13}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":20}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":35}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":43}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":56}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":57}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":64}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":68}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":76}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":84}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":92}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":118}},{"source":"../src/Session.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":120}},{"source":"../src/Session.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":126}},{"source":"../src/Session.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":128}},{"source":"../src/Session.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":136}},{"source":"../src/Session.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":1,"column":146}},{"source":"../src/Session.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":1,"column":148}},{"source":"../src/Session.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":1,"column":156}},{"source":"../src/Session.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":1,"column":191}},{"source":"../src/Session.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":1,"column":193}},{"source":"../src/Session.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":1,"column":201}},{"source":"../src/Session.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":1,"column":209}},{"source":"../src/Session.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":1,"column":211}},{"source":"../src/Session.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":1,"column":219}},{"source":"../src/Session.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":1,"column":237}},{"source":"../src/Session.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":1,"column":239}},{"source":"../src/Session.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":1,"column":247}},{"source":"../src/Session.ts","name":null,"original":{"line":97,"column":7},"generated":{"line":1,"column":261}},{"source":"../src/Session.ts","name":null,"original":{"line":97,"column":22},"generated":{"line":1,"column":276}},{"source":"../src/Session.ts","name":null,"original":{"line":98,"column":2},"generated":{"line":1,"column":278}},{"source":"../src/Session.ts","name":null,"original":{"line":99,"column":2},"generated":{"line":1,"column":280}},{"source":"../src/Session.ts","name":null,"original":{"line":100,"column":2},"generated":{"line":1,"column":282}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":285}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":289}},{"source":"../src/Session.ts","name":null,"original":{"line":102,"column":2},"generated":{"line":1,"column":291}},{"source":"../src/Session.ts","name":null,"original":{"line":102,"column":8},"generated":{"line":1,"column":297}},{"source":"../src/Session.ts","name":null,"original":{"line":102,"column":34},"generated":{"line":1,"column":305}},{"source":"../src/Session.ts","name":null,"original":{"line":102,"column":46},"generated":{"line":1,"column":307}},{"source":"../src/Session.ts","name":null,"original":{"line":102,"column":69},"generated":{"line":1,"column":330}},{"source":"../src/Session.ts","name":null,"original":{"line":103,"column":2},"generated":{"line":1,"column":333}},{"source":"../src/Session.ts","name":null,"original":{"line":103,"column":28},"generated":{"line":1,"column":340}},{"source":"../src/Session.ts","name":null,"original":{"line":103,"column":6},"generated":{"line":1,"column":347}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":4},"generated":{"line":1,"column":351}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":11},"generated":{"line":1,"column":358}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":24},"generated":{"line":1,"column":371}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":32},"generated":{"line":1,"column":379}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":32},"generated":{"line":1,"column":381}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":49},"generated":{"line":1,"column":397}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":56},"generated":{"line":1,"column":404}},{"source":"../src/Session.ts","name":null,"original":{"line":108,"column":65},"generated":{"line":1,"column":413}},{"source":"../src/Session.ts","name":null,"original":{"line":109,"column":10},"generated":{"line":1,"column":425}},{"source":"../src/Session.ts","name":null,"original":{"line":109,"column":22},"generated":{"line":1,"column":427}},{"source":"../src/Session.ts","name":null,"original":{"line":110,"column":6},"generated":{"line":1,"column":433}},{"source":"../src/Session.ts","name":null,"original":{"line":111,"column":8},"generated":{"line":1,"column":434}},{"source":"../src/Session.ts","name":null,"original":{"line":111,"column":8},"generated":{"line":1,"column":444}},{"source":"../src/Session.ts","name":null,"original":{"line":112,"column":8},"generated":{"line":1,"column":446}},{"source":"../src/Session.ts","name":null,"original":{"line":112,"column":16},"generated":{"line":1,"column":453}},{"source":"../src/Session.ts","name":null,"original":{"line":113,"column":8},"generated":{"line":1,"column":460}},{"source":"../src/Session.ts","name":null,"original":{"line":113,"column":20},"generated":{"line":1,"column":471}},{"source":"../src/Session.ts","name":null,"original":{"line":113,"column":38},"generated":{"line":1,"column":473}},{"source":"../src/Session.ts","name":null,"original":{"line":114,"column":8},"generated":{"line":1,"column":480}},{"source":"../src/Session.ts","name":null,"original":{"line":114,"column":21},"generated":{"line":1,"column":492}},{"source":"../src/Session.ts","name":null,"original":{"line":114,"column":39},"generated":{"line":1,"column":494}},{"source":"../src/Session.ts","name":null,"original":{"line":115,"column":8},"generated":{"line":1,"column":506}},{"source":"../src/Session.ts","name":null,"original":{"line":115,"column":18},"generated":{"line":1,"column":515}},{"source":"../src/Session.ts","name":null,"original":{"line":115,"column":36},"generated":{"line":1,"column":517}},{"source":"../src/Session.ts","name":null,"original":{"line":116,"column":8},"generated":{"line":1,"column":529}},{"source":"../src/Session.ts","name":null,"original":{"line":116,"column":22},"generated":{"line":1,"column":542}},{"source":"../src/Session.ts","name":null,"original":{"line":116,"column":40},"generated":{"line":1,"column":544}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":8},"generated":{"line":1,"column":560}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":46},"generated":{"line":1,"column":570}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":19},"generated":{"line":1,"column":578}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":19},"generated":{"line":1,"column":580}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":37},"generated":{"line":1,"column":582}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":46},"generated":{"line":1,"column":599}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":46},"generated":{"line":1,"column":603}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":46},"generated":{"line":1,"column":605}},{"source":"../src/Session.ts","name":null,"original":{"line":117,"column":50},"generated":{"line":1,"column":607}},{"source":"../src/Session.ts","name":null,"original":{"line":119,"column":6},"generated":{"line":1,"column":615}},{"source":"../src/Session.ts","name":null,"original":{"line":121,"column":11},"generated":{"line":1,"column":619}},{"source":"../src/Session.ts","name":null,"original":{"line":126,"column":0},"generated":{"line":1,"column":622}},{"source":"../src/Session.ts","name":null,"original":{"line":126,"column":9},"generated":{"line":1,"column":631}},{"source":"../src/Session.ts","name":null,"original":{"line":127,"column":2},"generated":{"line":1,"column":633}},{"source":"../src/Session.ts","name":null,"original":{"line":129,"column":2},"generated":{"line":1,"column":636}},{"source":"../src/Session.ts","name":null,"original":{"line":129,"column":11},"generated":{"line":1,"column":645}},{"source":"../src/Session.ts","name":null,"original":{"line":129,"column":11},"generated":{"line":1,"column":651}},{"source":"../src/Session.ts","name":null,"original":{"line":129,"column":22},"generated":{"line":1,"column":658}},{"source":"../src/Session.ts","name":null,"original":{"line":129,"column":11},"generated":{"line":1,"column":660}},{"source":"../src/Session.ts","name":null,"original":{"line":129,"column":24},"generated":{"line":1,"column":662}},{"source":"../src/Session.ts","name":null,"original":{"line":97,"column":0},"generated":{"line":1,"column":674}},{"source":"../src/Session.ts","name":null,"original":{"line":97,"column":0},"generated":{"line":1,"column":682}},{"source":"../src/Session.ts","name":null,"original":{"line":97,"column":0},"generated":{"line":1,"column":703}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":705}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":13},"generated":{"line":1,"column":711}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":29},"generated":{"line":1,"column":721}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":29},"generated":{"line":1,"column":723}},{"source":"../src/Session.ts","name":null,"original":{"line":160,"column":2},"generated":{"line":1,"column":736}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":45},"generated":{"line":1,"column":750}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":45},"generated":{"line":1,"column":754}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":45},"generated":{"line":1,"column":756}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":4},"generated":{"line":1,"column":760}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":762}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":772}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":779}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":787}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":791}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":801}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":804}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":814}},{"source":"../src/Session.ts","name":null,"original":{"line":161,"column":47},"generated":{"line":1,"column":817}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":4},"generated":{"line":1,"column":820}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":822}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":832}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":839}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":847}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":851}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":861}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":864}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":874}},{"source":"../src/Session.ts","name":null,"original":{"line":162,"column":36},"generated":{"line":1,"column":882}},{"source":"../src/Session.ts","name":null,"original":{"line":164,"column":4},"generated":{"line":1,"column":884}},{"source":"../src/Session.ts","name":null,"original":{"line":164,"column":11},"generated":{"line":1,"column":892}},{"source":"../src/Session.ts","name":null,"original":{"line":164,"column":11},"generated":{"line":1,"column":894}},{"source":"../src/Session.ts","name":null,"original":{"line":143,"column":10},"generated":{"line":1,"column":899}},{"source":"../src/Session.ts","name":null,"original":{"line":143,"column":10},"generated":{"line":1,"column":904}},{"source":"../src/Session.ts","name":null,"original":{"line":143,"column":35},"generated":{"line":1,"column":928}},{"source":"../src/Session.ts","name":null,"original":{"line":211,"column":2},"generated":{"line":1,"column":930}},{"source":"../src/Session.ts","name":null,"original":{"line":211,"column":2},"generated":{"line":1,"column":935}},{"source":"../src/Session.ts","name":null,"original":{"line":211,"column":10},"generated":{"line":1,"column":941}},{"source":"../src/Session.ts","name":null,"original":{"line":211,"column":10},"generated":{"line":1,"column":948}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":952}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":956}},{"source":"../src/Session.ts","name":null,"original":{"line":225,"column":4},"generated":{"line":1,"column":958}},{"source":"../src/Session.ts","name":null,"original":{"line":212,"column":10},"generated":{"line":1,"column":971}},{"source":"../src/Session.ts","name":null,"original":{"line":212,"column":15},"generated":{"line":1,"column":976}},{"source":"../src/Session.ts","name":null,"original":{"line":212,"column":36},"generated":{"line":1,"column":997}},{"source":"../src/Session.ts","name":null,"original":{"line":213,"column":6},"generated":{"line":1,"column":1003}},{"source":"../src/Session.ts","name":null,"original":{"line":214,"column":8},"generated":{"line":1,"column":1004}},{"source":"../src/Session.ts","name":null,"original":{"line":214,"column":19},"generated":{"line":1,"column":1014}},{"source":"../src/Session.ts","name":null,"original":{"line":214,"column":24},"generated":{"line":1,"column":1019}},{"source":"../src/Session.ts","name":null,"original":{"line":214,"column":29},"generated":{"line":1,"column":1024}},{"source":"../src/Session.ts","name":null,"original":{"line":215,"column":11},"generated":{"line":1,"column":1037}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":8},"generated":{"line":1,"column":1039}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":36},"generated":{"line":1,"column":1049}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":19},"generated":{"line":1,"column":1057}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":19},"generated":{"line":1,"column":1059}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":27},"generated":{"line":1,"column":1061}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":36},"generated":{"line":1,"column":1078}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":36},"generated":{"line":1,"column":1082}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":36},"generated":{"line":1,"column":1084}},{"source":"../src/Session.ts","name":null,"original":{"line":217,"column":40},"generated":{"line":1,"column":1086}},{"source":"../src/Session.ts","name":null,"original":{"line":219,"column":6},"generated":{"line":1,"column":1094}},{"source":"../src/Session.ts","name":null,"original":{"line":225,"column":11},"generated":{"line":1,"column":1100}},{"source":"../src/Session.ts","name":null,"original":{"line":225,"column":15},"generated":{"line":1,"column":1104}},{"source":"../src/Session.ts","name":null,"original":{"line":225,"column":23},"generated":{"line":1,"column":1112}},{"source":"../src/Session.ts","name":null,"original":{"line":234,"column":2},"generated":{"line":1,"column":1122}},{"source":"../src/Session.ts","name":null,"original":{"line":234,"column":2},"generated":{"line":1,"column":1127}},{"source":"../src/Session.ts","name":null,"original":{"line":234,"column":24},"generated":{"line":1,"column":1133}},{"source":"../src/Session.ts","name":null,"original":{"line":234,"column":31},"generated":{"line":1,"column":1140}},{"source":"../src/Session.ts","name":null,"original":{"line":234,"column":36},"generated":{"line":1,"column":1142}},{"source":"../src/Session.ts","name":null,"original":{"line":235,"column":11},"generated":{"line":1,"column":1146}},{"source":"../src/Session.ts","name":null,"original":{"line":235,"column":16},"generated":{"line":1,"column":1151}},{"source":"../src/Session.ts","name":null,"original":{"line":235,"column":37},"generated":{"line":1,"column":1172}},{"source":"../src/Session.ts","name":null,"original":{"line":235,"column":43},"generated":{"line":1,"column":1178}},{"source":"../src/Session.ts","name":null,"original":{"line":235,"column":48},"generated":{"line":1,"column":1180}},{"source":"../src/Session.ts","name":null,"original":{"line":245,"column":10},"generated":{"line":1,"column":1184}},{"source":"../src/Session.ts","name":null,"original":{"line":245,"column":10},"generated":{"line":1,"column":1189}},{"source":"../src/Session.ts","name":null,"original":{"line":245,"column":27},"generated":{"line":1,"column":1204}},{"source":"../src/Session.ts","name":null,"original":{"line":245,"column":27},"generated":{"line":1,"column":1211}},{"source":"../src/Session.ts","name":null,"original":{"line":249,"column":4},"generated":{"line":1,"column":1215}},{"source":"../src/Session.ts","name":null,"original":{"line":249,"column":11},"generated":{"line":1,"column":1222}},{"source":"../src/Session.ts","name":null,"original":{"line":249,"column":24},"generated":{"line":1,"column":1235}},{"source":"../src/Session.ts","name":null,"original":{"line":249,"column":35},"generated":{"line":1,"column":1246}},{"source":"../src/Session.ts","name":null,"original":{"line":249,"column":35},"generated":{"line":1,"column":1248}},{"source":"../src/Session.ts","name":null,"original":{"line":250,"column":10},"generated":{"line":1,"column":1275}},{"source":"../src/Session.ts","name":null,"original":{"line":250,"column":15},"generated":{"line":1,"column":1280}},{"source":"../src/Session.ts","name":null,"original":{"line":250,"column":36},"generated":{"line":1,"column":1301}},{"source":"../src/Session.ts","name":null,"original":{"line":250,"column":43},"generated":{"line":1,"column":1308}},{"source":"../src/Session.ts","name":null,"original":{"line":250,"column":48},"generated":{"line":1,"column":1313}},{"source":"../src/Session.ts","name":null,"original":{"line":250,"column":53},"generated":{"line":1,"column":1318}},{"source":"../src/Session.ts","name":null,"original":{"line":251,"column":4},"generated":{"line":1,"column":1329}},{"source":"../src/Session.ts","name":null,"original":{"line":251,"column":9},"generated":{"line":1,"column":1334}},{"source":"../src/Session.ts","name":null,"original":{"line":251,"column":14},"generated":{"line":1,"column":1339}},{"source":"../src/Session.ts","name":null,"original":{"line":251,"column":27},"generated":{"line":1,"column":1351}},{"source":"../src/Session.ts","name":null,"original":{"line":252,"column":8},"generated":{"line":1,"column":1353}},{"source":"../src/Session.ts","name":null,"original":{"line":253,"column":6},"generated":{"line":1,"column":1356}},{"source":"../src/Session.ts","name":null,"original":{"line":253,"column":11},"generated":{"line":1,"column":1361}},{"source":"../src/Session.ts","name":null,"original":{"line":253,"column":16},"generated":{"line":1,"column":1366}},{"source":"../src/Session.ts","name":null,"original":{"line":253,"column":16},"generated":{"line":1,"column":1368}},{"source":"../src/Session.ts","name":null,"original":{"line":253,"column":23},"generated":{"line":1,"column":1375}},{"source":"../src/Session.ts","name":null,"original":{"line":260,"column":2},"generated":{"line":1,"column":1385}},{"source":"../src/Session.ts","name":null,"original":{"line":260,"column":2},"generated":{"line":1,"column":1390}},{"source":"../src/Session.ts","name":null,"original":{"line":260,"column":11},"generated":{"line":1,"column":1397}},{"source":"../src/Session.ts","name":null,"original":{"line":260,"column":38},"generated":{"line":1,"column":1407}},{"source":"../src/Session.ts","name":null,"original":{"line":260,"column":43},"generated":{"line":1,"column":1412}},{"source":"../src/Session.ts","name":null,"original":{"line":260,"column":58},"generated":{"line":1,"column":1428}},{"source":"../src/Session.ts","name":null,"original":{"line":268,"column":2},"generated":{"line":1,"column":1432}},{"source":"../src/Session.ts","name":null,"original":{"line":268,"column":2},"generated":{"line":1,"column":1437}},{"source":"../src/Session.ts","name":null,"original":{"line":268,"column":27},"generated":{"line":1,"column":1460}},{"source":"../src/Session.ts","name":null,"original":{"line":270,"column":41},"generated":{"line":1,"column":1477}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":4},"generated":{"line":1,"column":1481}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1483}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1493}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1500}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1508}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1512}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1522}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1525}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1535}},{"source":"../src/Session.ts","name":null,"original":{"line":269,"column":60},"generated":{"line":1,"column":1538}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":1541}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":1545}},{"source":"../src/Session.ts","name":null,"original":{"line":271,"column":4},"generated":{"line":1,"column":1547}},{"source":"../src/Session.ts","name":null,"original":{"line":271,"column":8},"generated":{"line":1,"column":1550}},{"source":"../src/Session.ts","name":null,"original":{"line":271,"column":13},"generated":{"line":1,"column":1552}},{"source":"../src/Session.ts","name":null,"original":{"line":271,"column":18},"generated":{"line":1,"column":1557}},{"source":"../src/Session.ts","name":null,"original":{"line":272,"column":6},"generated":{"line":1,"column":1568}},{"source":"../src/Session.ts","name":null,"original":{"line":272,"column":13},"generated":{"line":1,"column":1575}},{"source":"../src/Session.ts","name":null,"original":{"line":272,"column":18},"generated":{"line":1,"column":1577}},{"source":"../src/Session.ts","name":null,"original":{"line":275,"column":4},"generated":{"line":1,"column":1582}},{"source":"../src/Session.ts","name":null,"original":{"line":275,"column":8},"generated":{"line":1,"column":1585}},{"source":"../src/Session.ts","name":null,"original":{"line":275,"column":13},"generated":{"line":1,"column":1587}},{"source":"../src/Session.ts","name":null,"original":{"line":276,"column":6},"generated":{"line":1,"column":1610}},{"source":"../src/Session.ts","name":null,"original":{"line":278,"column":4},"generated":{"line":1,"column":1617}},{"source":"../src/Session.ts","name":null,"original":{"line":278,"column":10},"generated":{"line":1,"column":1623}},{"source":"../src/Session.ts","name":null,"original":{"line":279,"column":30},"generated":{"line":1,"column":1625}},{"source":"../src/Session.ts","name":null,"original":{"line":279,"column":13},"generated":{"line":1,"column":1642}},{"source":"../src/Session.ts","name":null,"original":{"line":279,"column":41},"generated":{"line":1,"column":1644}},{"source":"../src/Session.ts","name":null,"original":{"line":279,"column":43},"generated":{"line":1,"column":1645}},{"source":"../src/Session.ts","name":null,"original":{"line":279,"column":48},"generated":{"line":1,"column":1649}},{"source":"../src/Session.ts","name":null,"original":{"line":279,"column":65},"generated":{"line":1,"column":1652}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":10},"generated":{"line":1,"column":1654}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":27},"generated":{"line":1,"column":1656}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":16},"generated":{"line":1,"column":1664}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":16},"generated":{"line":1,"column":1666}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":24},"generated":{"line":1,"column":1668}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":27},"generated":{"line":1,"column":1679}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":27},"generated":{"line":1,"column":1683}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":27},"generated":{"line":1,"column":1685}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":31},"generated":{"line":1,"column":1687}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":38},"generated":{"line":1,"column":1694}},{"source":"../src/Session.ts","name":null,"original":{"line":280,"column":47},"generated":{"line":1,"column":1703}},{"source":"../src/Session.ts","name":null,"original":{"line":282,"column":4},"generated":{"line":1,"column":1708}},{"source":"../src/Session.ts","name":null,"original":{"line":282,"column":9},"generated":{"line":1,"column":1710}},{"source":"../src/Session.ts","name":null,"original":{"line":282,"column":34},"generated":{"line":1,"column":1734}},{"source":"../src/Session.ts","name":null,"original":{"line":283,"column":4},"generated":{"line":1,"column":1736}},{"source":"../src/Session.ts","name":null,"original":{"line":283,"column":10},"generated":{"line":1,"column":1742}},{"source":"../src/Session.ts","name":null,"original":{"line":283,"column":30},"generated":{"line":1,"column":1750}},{"source":"../src/Session.ts","name":null,"original":{"line":283,"column":35},"generated":{"line":1,"column":1752}},{"source":"../src/Session.ts","name":null,"original":{"line":283,"column":56},"generated":{"line":1,"column":1773}},{"source":"../src/Session.ts","name":null,"original":{"line":284,"column":6},"generated":{"line":1,"column":1796}},{"source":"../src/Session.ts","name":null,"original":{"line":285,"column":6},"generated":{"line":1,"column":1798}},{"source":"../src/Session.ts","name":null,"original":{"line":287,"column":4},"generated":{"line":1,"column":1801}},{"source":"../src/Session.ts","name":null,"original":{"line":287,"column":8},"generated":{"line":1,"column":1804}},{"source":"../src/Session.ts","name":null,"original":{"line":287,"column":19},"generated":{"line":1,"column":1806}},{"source":"../src/Session.ts","name":null,"original":{"line":287,"column":33},"generated":{"line":1,"column":1809}},{"source":"../src/Session.ts","name":null,"original":{"line":288,"column":6},"generated":{"line":1,"column":1810}},{"source":"../src/Session.ts","name":null,"original":{"line":288,"column":11},"generated":{"line":1,"column":1812}},{"source":"../src/Session.ts","name":null,"original":{"line":288,"column":26},"generated":{"line":1,"column":1827}},{"source":"../src/Session.ts","name":null,"original":{"line":289,"column":6},"generated":{"line":1,"column":1830}},{"source":"../src/Session.ts","name":null,"original":{"line":289,"column":12},"generated":{"line":1,"column":1836}},{"source":"../src/Session.ts","name":null,"original":{"line":289,"column":25},"generated":{"line":1,"column":1838}},{"source":"../src/Session.ts","name":null,"original":{"line":289,"column":32},"generated":{"line":1,"column":1845}},{"source":"../src/Session.ts","name":null,"original":{"line":289,"column":45},"generated":{"line":1,"column":1858}},{"source":"../src/Session.ts","name":null,"original":{"line":289,"column":53},"generated":{"line":1,"column":1866}},{"source":"../src/Session.ts","name":null,"original":{"line":289,"column":53},"generated":{"line":1,"column":1868}},{"source":"../src/Session.ts","name":null,"original":{"line":290,"column":25},"generated":{"line":1,"column":1885}},{"source":"../src/Session.ts","name":null,"original":{"line":290,"column":10},"generated":{"line":1,"column":1892}},{"source":"../src/Session.ts","name":null,"original":{"line":293,"column":8},"generated":{"line":1,"column":1894}},{"source":"../src/Session.ts","name":null,"original":{"line":293,"column":13},"generated":{"line":1,"column":1896}},{"source":"../src/Session.ts","name":null,"original":{"line":293,"column":18},"generated":{"line":1,"column":1901}},{"source":"../src/Session.ts","name":null,"original":{"line":293,"column":18},"generated":{"line":1,"column":1903}},{"source":"../src/Session.ts","name":null,"original":{"line":293,"column":25},"generated":{"line":1,"column":1910}},{"source":"../src/Session.ts","name":null,"original":{"line":298,"column":8},"generated":{"line":1,"column":1918}},{"source":"../src/Session.ts","name":null,"original":{"line":298,"column":15},"generated":{"line":1,"column":1925}},{"source":"../src/Session.ts","name":null,"original":{"line":298,"column":28},"generated":{"line":1,"column":1938}},{"source":"../src/Session.ts","name":null,"original":{"line":298,"column":39},"generated":{"line":1,"column":1949}},{"source":"../src/Session.ts","name":null,"original":{"line":298,"column":39},"generated":{"line":1,"column":1951}},{"source":"../src/Session.ts","name":null,"original":{"line":299,"column":8},"generated":{"line":1,"column":1968}},{"source":"../src/Session.ts","name":null,"original":{"line":299,"column":13},"generated":{"line":1,"column":1970}},{"source":"../src/Session.ts","name":null,"original":{"line":299,"column":18},"generated":{"line":1,"column":1975}},{"source":"../src/Session.ts","name":null,"original":{"line":299,"column":18},"generated":{"line":1,"column":1977}},{"source":"../src/Session.ts","name":null,"original":{"line":299,"column":25},"generated":{"line":1,"column":1984}},{"source":"../src/Session.ts","name":null,"original":{"line":299,"column":43},"generated":{"line":1,"column":2001}},{"source":"../src/Session.ts","name":null,"original":{"line":301,"column":11},"generated":{"line":1,"column":2010}},{"source":"../src/Session.ts","name":null,"original":{"line":301,"column":50},"generated":{"line":1,"column":2014}},{"source":"../src/Session.ts","name":null,"original":{"line":301,"column":15},"generated":{"line":1,"column":2018}},{"source":"../src/Session.ts","name":null,"original":{"line":301,"column":23},"generated":{"line":1,"column":2020}},{"source":"../src/Session.ts","name":null,"original":{"line":301,"column":56},"generated":{"line":1,"column":2043}},{"source":"../src/Session.ts","name":null,"original":{"line":307,"column":6},"generated":{"line":1,"column":2044}},{"source":"../src/Session.ts","name":null,"original":{"line":307,"column":12},"generated":{"line":1,"column":2050}},{"source":"../src/Session.ts","name":null,"original":{"line":307,"column":30},"generated":{"line":1,"column":2052}},{"source":"../src/Session.ts","name":null,"original":{"line":307,"column":37},"generated":{"line":1,"column":2059}},{"source":"../src/Session.ts","name":null,"original":{"line":307,"column":50},"generated":{"line":1,"column":2072}},{"source":"../src/Session.ts","name":null,"original":{"line":307,"column":58},"generated":{"line":1,"column":2080}},{"source":"../src/Session.ts","name":null,"original":{"line":307,"column":58},"generated":{"line":1,"column":2082}},{"source":"../src/Session.ts","name":null,"original":{"line":310,"column":6},"generated":{"line":1,"column":2103}},{"source":"../src/Session.ts","name":null,"original":{"line":310,"column":30},"generated":{"line":1,"column":2106}},{"source":"../src/Session.ts","name":null,"original":{"line":310,"column":10},"generated":{"line":1,"column":2113}},{"source":"../src/Session.ts","name":null,"original":{"line":310,"column":36},"generated":{"line":1,"column":2115}},{"source":"../src/Session.ts","name":null,"original":{"line":320,"column":8},"generated":{"line":1,"column":2116}},{"source":"../src/Session.ts","name":null,"original":{"line":311,"column":52},"generated":{"line":1,"column":2125}},{"source":"../src/Session.ts","name":null,"original":{"line":312,"column":10},"generated":{"line":1,"column":2127}},{"source":"../src/Session.ts","name":null,"original":{"line":313,"column":10},"generated":{"line":1,"column":2129}},{"source":"../src/Session.ts","name":null,"original":{"line":313,"column":15},"generated":{"line":1,"column":2131}},{"source":"../src/Session.ts","name":null,"original":{"line":314,"column":10},"generated":{"line":1,"column":2152}},{"source":"../src/Session.ts","name":null,"original":{"line":321,"column":10},"generated":{"line":1,"column":2155}},{"source":"../src/Session.ts","name":null,"original":{"line":321,"column":17},"generated":{"line":1,"column":2162}},{"source":"../src/Session.ts","name":null,"original":{"line":321,"column":21},"generated":{"line":1,"column":2166}},{"source":"../src/Session.ts","name":null,"original":{"line":321,"column":29},"generated":{"line":1,"column":2174}},{"source":"../src/Session.ts","name":null,"original":{"line":326,"column":4},"generated":{"line":1,"column":2183}},{"source":"../src/Session.ts","name":null,"original":{"line":325,"column":4},"generated":{"line":1,"column":2190}},{"source":"../src/Session.ts","name":null,"original":{"line":325,"column":9},"generated":{"line":1,"column":2192}},{"source":"../src/Session.ts","name":null,"original":{"line":325,"column":34},"generated":{"line":1,"column":2216}},{"source":"../src/Session.ts","name":null,"original":{"line":326,"column":11},"generated":{"line":1,"column":2218}},{"source":"../src/Session.ts","name":null,"original":{"line":166,"column":8},"generated":{"line":1,"column":2221}},{"source":"../src/Session.ts","name":null,"original":{"line":166,"column":23},"generated":{"line":1,"column":2223}},{"source":"../src/Session.ts","name":null,"original":{"line":167,"column":6},"generated":{"line":1,"column":2244}},{"source":"../src/Session.ts","name":null,"original":{"line":167,"column":11},"generated":{"line":1,"column":2249}},{"source":"../src/Session.ts","name":null,"original":{"line":167,"column":34},"generated":{"line":1,"column":2270}},{"source":"../src/Session.ts","name":null,"original":{"line":167,"column":49},"generated":{"line":1,"column":2272}},{"source":"../src/Session.ts","name":null,"original":{"line":168,"column":15},"generated":{"line":1,"column":2293}},{"source":"../src/Session.ts","name":null,"original":{"line":168,"column":30},"generated":{"line":1,"column":2295}},{"source":"../src/Session.ts","name":null,"original":{"line":168,"column":47},"generated":{"line":1,"column":2310}},{"source":"../src/Session.ts","name":null,"original":{"line":168,"column":62},"generated":{"line":1,"column":2312}},{"source":"../src/Session.ts","name":null,"original":{"line":169,"column":6},"generated":{"line":1,"column":2328}},{"source":"../src/Session.ts","name":null,"original":{"line":169,"column":11},"generated":{"line":1,"column":2333}},{"source":"../src/Session.ts","name":null,"original":{"line":169,"column":34},"generated":{"line":1,"column":2355}},{"source":"../src/Session.ts","name":null,"original":{"line":169,"column":34},"generated":{"line":1,"column":2357}},{"source":"../src/Session.ts","name":null,"original":{"line":169,"column":34},"generated":{"line":1,"column":2359}},{"source":"../src/Session.ts","name":null,"original":{"line":169,"column":74},"generated":{"line":1,"column":2400}},{"source":"../src/Session.ts","name":null,"original":{"line":170,"column":8},"generated":{"line":1,"column":2401}},{"source":"../src/Session.ts","name":null,"original":{"line":170,"column":23},"generated":{"line":1,"column":2415}},{"source":"../src/Session.ts","name":null,"original":{"line":170,"column":38},"generated":{"line":1,"column":2417}},{"source":"../src/Session.ts","name":null,"original":{"line":171,"column":8},"generated":{"line":1,"column":2431}},{"source":"../src/Session.ts","name":null,"original":{"line":171,"column":25},"generated":{"line":1,"column":2447}},{"source":"../src/Session.ts","name":null,"original":{"line":171,"column":40},"generated":{"line":1,"column":2449}},{"source":"../src/Session.ts","name":null,"original":{"line":174,"column":6},"generated":{"line":1,"column":2467}},{"source":"../src/Session.ts","name":null,"original":{"line":174,"column":11},"generated":{"line":1,"column":2472}},{"source":"../src/Session.ts","name":null,"original":{"line":174,"column":34},"generated":{"line":1,"column":2494}},{"source":"../src/Session.ts","name":null,"original":{"line":174,"column":34},"generated":{"line":1,"column":2496}},{"source":"../src/Session.ts","name":null,"original":{"line":174,"column":34},"generated":{"line":1,"column":2498}},{"source":"../src/Session.ts","name":null,"original":{"line":174,"column":74},"generated":{"line":1,"column":2539}},{"source":"../src/Session.ts","name":null,"original":{"line":177,"column":8},"generated":{"line":1,"column":2543}},{"source":"../src/Session.ts","name":null,"original":{"line":177,"column":23},"generated":{"line":1,"column":2545}},{"source":"../src/Session.ts","name":null,"original":{"line":178,"column":6},"generated":{"line":1,"column":2557}},{"source":"../src/Session.ts","name":null,"original":{"line":178,"column":11},"generated":{"line":1,"column":2562}},{"source":"../src/Session.ts","name":null,"original":{"line":178,"column":18},"generated":{"line":1,"column":2567}},{"source":"../src/Session.ts","name":null,"original":{"line":179,"column":8},"generated":{"line":1,"column":2568}},{"source":"../src/Session.ts","name":null,"original":{"line":179,"column":19},"generated":{"line":1,"column":2578}},{"source":"../src/Session.ts","name":null,"original":{"line":179,"column":34},"generated":{"line":1,"column":2580}},{"source":"../src/Session.ts","name":null,"original":{"line":179,"column":46},"generated":{"line":1,"column":2592}},{"source":"../src/Session.ts","name":null,"original":{"line":180,"column":8},"generated":{"line":1,"column":2602}},{"source":"../src/Session.ts","name":null,"original":{"line":180,"column":20},"generated":{"line":1,"column":2614}},{"source":"../src/Session.ts","name":null,"original":{"line":181,"column":8},"generated":{"line":1,"column":2616}},{"source":"../src/Session.ts","name":null,"original":{"line":181,"column":15},"generated":{"line":1,"column":2622}},{"source":"../src/Session.ts","name":null,"original":{"line":181,"column":30},"generated":{"line":1,"column":2624}},{"source":"../src/Session.ts","name":null,"original":{"line":181,"column":42},"generated":{"line":1,"column":2636}},{"source":"../src/Session.ts","name":null,"original":{"line":184,"column":6},"generated":{"line":1,"column":2643}},{"source":"../src/Session.ts","name":null,"original":{"line":184,"column":11},"generated":{"line":1,"column":2648}},{"source":"../src/Session.ts","name":null,"original":{"line":184,"column":18},"generated":{"line":1,"column":2653}},{"source":"../src/Session.ts","name":null,"original":{"line":185,"column":8},"generated":{"line":1,"column":2654}},{"source":"../src/Session.ts","name":null,"original":{"line":185,"column":19},"generated":{"line":1,"column":2664}},{"source":"../src/Session.ts","name":null,"original":{"line":185,"column":19},"generated":{"line":1,"column":2670}},{"source":"../src/Session.ts","name":null,"original":{"line":185,"column":19},"generated":{"line":1,"column":2672}},{"source":"../src/Session.ts","name":null,"original":{"line":185,"column":32},"generated":{"line":1,"column":2675}},{"source":"../src/Session.ts","name":null,"original":{"line":185,"column":32},"generated":{"line":1,"column":2677}},{"source":"../src/Session.ts","name":null,"original":{"line":185,"column":32},"generated":{"line":1,"column":2679}},{"source":"../src/Session.ts","name":null,"original":{"line":186,"column":8},"generated":{"line":1,"column":2685}},{"source":"../src/Session.ts","name":null,"original":{"line":186,"column":20},"generated":{"line":1,"column":2697}},{"source":"../src/Session.ts","name":null,"original":{"line":194,"column":4},"generated":{"line":1,"column":2700}},{"source":"../src/Session.ts","name":null,"original":{"line":194,"column":9},"generated":{"line":1,"column":2705}},{"source":"../src/Session.ts","name":null,"original":{"line":194,"column":12},"generated":{"line":1,"column":2708}},{"source":"../src/Session.ts","name":null,"original":{"line":194,"column":12},"generated":{"line":1,"column":2710}},{"source":"../src/Session.ts","name":null,"original":{"line":194,"column":19},"generated":{"line":1,"column":2717}},{"source":"../src/Session.ts","name":null,"original":{"line":194,"column":26},"generated":{"line":1,"column":2723}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":6},"generated":{"line":1,"column":2727}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":13},"generated":{"line":1,"column":2734}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":26},"generated":{"line":1,"column":2747}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":34},"generated":{"line":1,"column":2755}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":34},"generated":{"line":1,"column":2757}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":55},"generated":{"line":1,"column":2777}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":60},"generated":{"line":1,"column":2782}},{"source":"../src/Session.ts","name":null,"original":{"line":195,"column":65},"generated":{"line":1,"column":2787}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":4},"generated":{"line":1,"column":2799}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":9},"generated":{"line":1,"column":2804}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":12},"generated":{"line":1,"column":2807}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":12},"generated":{"line":1,"column":2809}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":19},"generated":{"line":1,"column":2816}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":36},"generated":{"line":1,"column":2832}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":42},"generated":{"line":1,"column":2836}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":47},"generated":{"line":1,"column":2841}},{"source":"../src/Session.ts","name":null,"original":{"line":198,"column":62},"generated":{"line":1,"column":2857}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":4},"generated":{"line":1,"column":2861}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":9},"generated":{"line":1,"column":2866}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":12},"generated":{"line":1,"column":2869}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":12},"generated":{"line":1,"column":2871}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":19},"generated":{"line":1,"column":2878}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":26},"generated":{"line":1,"column":2884}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":32},"generated":{"line":1,"column":2888}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":37},"generated":{"line":1,"column":2893}},{"source":"../src/Session.ts","name":null,"original":{"line":200,"column":52},"generated":{"line":1,"column":2909}},{"source":"../src/Session.ts","name":null,"original":{"line":336,"column":2},"generated":{"line":1,"column":2913}},{"source":"../src/Session.ts","name":null,"original":{"line":336,"column":10},"generated":{"line":1,"column":2921}},{"source":"../src/Session.ts","name":null,"original":{"line":337,"column":4},"generated":{"line":1,"column":2924}},{"source":"../src/Session.ts","name":null,"original":{"line":337,"column":9},"generated":{"line":1,"column":2929}},{"source":"../src/Session.ts","name":null,"original":{"line":337,"column":12},"generated":{"line":1,"column":2932}},{"source":"../src/Session.ts","name":null,"original":{"line":337,"column":12},"generated":{"line":1,"column":2934}},{"source":"../src/Session.ts","name":null,"original":{"line":337,"column":19},"generated":{"line":1,"column":2941}},{"source":"../src/Session.ts","name":null,"original":{"line":337,"column":26},"generated":{"line":1,"column":2947}},{"source":"../src/Session.ts","name":null,"original":{"line":345,"column":2},"generated":{"line":1,"column":2950}},{"source":"../src/Session.ts","name":null,"original":{"line":345,"column":11},"generated":{"line":1,"column":2959}},{"source":"../src/Session.ts","name":null,"original":{"line":346,"column":4},"generated":{"line":1,"column":2962}},{"source":"../src/Session.ts","name":null,"original":{"line":346,"column":9},"generated":{"line":1,"column":2967}},{"source":"../src/Session.ts","name":null,"original":{"line":346,"column":12},"generated":{"line":1,"column":2970}},{"source":"../src/Session.ts","name":null,"original":{"line":346,"column":12},"generated":{"line":1,"column":2972}},{"source":"../src/Session.ts","name":null,"original":{"line":346,"column":19},"generated":{"line":1,"column":2979}},{"source":"../src/Session.ts","name":null,"original":{"line":346,"column":27},"generated":{"line":1,"column":2986}},{"source":"../src/Session.ts","name":null,"original":{"line":355,"column":2},"generated":{"line":1,"column":2989}},{"source":"../src/Session.ts","name":null,"original":{"line":356,"column":4},"generated":{"line":1,"column":2997}},{"source":"../src/Session.ts","name":null,"original":{"line":361,"column":4},"generated":{"line":1,"column":3000}},{"source":"../src/Session.ts","name":null,"original":{"line":361,"column":9},"generated":{"line":1,"column":3005}},{"source":"../src/Session.ts","name":null,"original":{"line":361,"column":12},"generated":{"line":1,"column":3008}},{"source":"../src/Session.ts","name":null,"original":{"line":361,"column":12},"generated":{"line":1,"column":3010}},{"source":"../src/Session.ts","name":null,"original":{"line":361,"column":19},"generated":{"line":1,"column":3017}},{"source":"../src/Session.ts","name":null,"original":{"line":361,"column":26},"generated":{"line":1,"column":3023}},{"source":"../src/Session.ts","name":null,"original":{"line":372,"column":2},"generated":{"line":1,"column":3026}},{"source":"../src/Session.ts","name":null,"original":{"line":372,"column":19},"generated":{"line":1,"column":3043}},{"source":"../src/Session.ts","name":null,"original":{"line":373,"column":4},"generated":{"line":1,"column":3046}},{"source":"../src/Session.ts","name":null,"original":{"line":373,"column":9},"generated":{"line":1,"column":3051}},{"source":"../src/Session.ts","name":null,"original":{"line":373,"column":12},"generated":{"line":1,"column":3054}},{"source":"../src/Session.ts","name":null,"original":{"line":373,"column":12},"generated":{"line":1,"column":3056}},{"source":"../src/Session.ts","name":null,"original":{"line":373,"column":19},"generated":{"line":1,"column":3063}},{"source":"../src/Session.ts","name":null,"original":{"line":373,"column":37},"generated":{"line":1,"column":3080}},{"source":"../src/Session.ts","name":null,"original":{"line":382,"column":2},"generated":{"line":1,"column":3083}},{"source":"../src/Session.ts","name":null,"original":{"line":382,"column":22},"generated":{"line":1,"column":3103}},{"source":"../src/Session.ts","name":null,"original":{"line":383,"column":4},"generated":{"line":1,"column":3106}},{"source":"../src/Session.ts","name":null,"original":{"line":383,"column":9},"generated":{"line":1,"column":3111}},{"source":"../src/Session.ts","name":null,"original":{"line":383,"column":12},"generated":{"line":1,"column":3114}},{"source":"../src/Session.ts","name":null,"original":{"line":383,"column":12},"generated":{"line":1,"column":3116}},{"source":"../src/Session.ts","name":null,"original":{"line":383,"column":19},"generated":{"line":1,"column":3123}},{"source":"../src/Session.ts","name":null,"original":{"line":383,"column":36},"generated":{"line":1,"column":3139}},{"source":"../src/Session.ts","name":null,"original":{"line":386,"column":10},"generated":{"line":1,"column":3142}},{"source":"../src/Session.ts","name":null,"original":{"line":387,"column":4},"generated":{"line":1,"column":3157}},{"source":"../src/Session.ts","name":null,"original":{"line":389,"column":4},"generated":{"line":1,"column":3160}},{"source":"../src/Session.ts","name":null,"original":{"line":389,"column":9},"generated":{"line":1,"column":3165}},{"source":"../src/Session.ts","name":null,"original":{"line":389,"column":14},"generated":{"line":1,"column":3170}},{"source":"../src/Session.ts","name":null,"original":{"line":389,"column":27},"generated":{"line":1,"column":3181}},{"source":"../src/Session.ts","name":null,"original":{"line":389,"column":39},"generated":{"line":1,"column":3183}},{"source":"../src/Session.ts","name":null,"original":{"line":390,"column":4},"generated":{"line":1,"column":3194}},{"source":"../src/Session.ts","name":null,"original":{"line":390,"column":9},"generated":{"line":1,"column":3199}},{"source":"../src/Session.ts","name":null,"original":{"line":390,"column":14},"generated":{"line":1,"column":3204}},{"source":"../src/Session.ts","name":null,"original":{"line":390,"column":22},"generated":{"line":1,"column":3210}},{"source":"../src/Session.ts","name":null,"original":{"line":390,"column":34},"generated":{"line":1,"column":3212}},{"source":"../src/Session.ts","name":null,"original":{"line":391,"column":4},"generated":{"line":1,"column":3218}},{"source":"../src/Session.ts","name":null,"original":{"line":391,"column":9},"generated":{"line":1,"column":3223}},{"source":"../src/Session.ts","name":null,"original":{"line":391,"column":14},"generated":{"line":1,"column":3228}},{"source":"../src/Session.ts","name":null,"original":{"line":391,"column":26},"generated":{"line":1,"column":3238}},{"source":"../src/Session.ts","name":null,"original":{"line":391,"column":38},"generated":{"line":1,"column":3240}},{"source":"../src/Session.ts","name":null,"original":{"line":392,"column":4},"generated":{"line":1,"column":3250}},{"source":"../src/Session.ts","name":null,"original":{"line":392,"column":9},"generated":{"line":1,"column":3255}},{"source":"../src/Session.ts","name":null,"original":{"line":392,"column":14},"generated":{"line":1,"column":3260}},{"source":"../src/Session.ts","name":null,"original":{"line":392,"column":31},"generated":{"line":1,"column":3275}},{"source":"../src/Session.ts","name":null,"original":{"line":392,"column":43},"generated":{"line":1,"column":3277}},{"source":"../src/Session.ts","name":null,"original":{"line":393,"column":4},"generated":{"line":1,"column":3292}},{"source":"../src/Session.ts","name":null,"original":{"line":393,"column":9},"generated":{"line":1,"column":3297}},{"source":"../src/Session.ts","name":null,"original":{"line":393,"column":12},"generated":{"line":1,"column":3300}},{"source":"../src/Session.ts","name":null,"original":{"line":393,"column":12},"generated":{"line":1,"column":3302}},{"source":"../src/Session.ts","name":null,"original":{"line":393,"column":19},"generated":{"line":1,"column":3309}},{"source":"../src/Session.ts","name":null,"original":{"line":393,"column":38},"generated":{"line":1,"column":3326}},{"source":"../src/Session.ts","name":null,"original":{"line":394,"column":6},"generated":{"line":1,"column":3330}},{"source":"../src/Session.ts","name":null,"original":{"line":394,"column":11},"generated":{"line":1,"column":3335}},{"source":"../src/Session.ts","name":null,"original":{"line":394,"column":16},"generated":{"line":1,"column":3340}},{"source":"../src/Session.ts","name":null,"original":{"line":394,"column":33},"generated":{"line":1,"column":3355}},{"source":"../src/Session.ts","name":null,"original":{"line":394,"column":38},"generated":{"line":1,"column":3360}},{"source":"../src/Session.ts","name":null,"original":{"line":394,"column":58},"generated":{"line":1,"column":3366}},{"source":"../src/Session.ts","name":null,"original":{"line":394,"column":46},"generated":{"line":1,"column":3370}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":3375}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":3383}},{"source":"../src/Session.ts","name":null,"original":{"line":135,"column":0},"generated":{"line":1,"column":3391}}],"sources":{"../src/Session.ts":"/*\r\n * Copyright 2022 Inrupt Inc.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to use,\r\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\r\n * Software, and to permit persons to whom the Software is furnished to do so,\r\n * subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\r\n * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\r\n * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\r\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * @hidden\r\n */\r\nimport { EventEmitter } from \"events\";\r\nimport {\r\n  EVENTS,\r\n  ILoginInputOptions,\r\n  ISessionInfo,\r\n  IStorage,\r\n} from \"@inrupt/solid-client-authn-core\";\r\nimport { v4 } from \"uuid\";\r\nimport ClientAuthentication from \"./ClientAuthentication\";\r\nimport { getClientAuthenticationWithDependencies } from \"./dependencies\";\r\nimport { KEY_CURRENT_SESSION, KEY_CURRENT_URL } from \"./constant\";\r\n\r\nexport interface ISessionOptions {\r\n  /**\r\n   * A private storage, unreachable to other scripts on the page. Typically in-memory.\r\n   */\r\n  secureStorage: IStorage;\r\n  /**\r\n   * A storage where non-sensitive information may be stored, potentially longer-lived than the secure storage.\r\n   */\r\n  insecureStorage: IStorage;\r\n  /**\r\n   * Details about the current session\r\n   */\r\n  sessionInfo: ISessionInfo;\r\n  /**\r\n   * An instance of the library core. Typically obtained using `getClientAuthenticationWithDependencies`.\r\n   */\r\n  clientAuthentication: ClientAuthentication;\r\n}\r\n\r\nexport interface IHandleIncomingRedirectOptions {\r\n  /**\r\n   * If the user has signed in before, setting this to `true` will automatically\r\n   * redirect them to their Solid Identity Provider, which will then attempt to\r\n   * re-activate the session and send the user back to your app without\r\n   * requiring user interaction.\r\n   * If your app's access has not expired yet and re-activation completed\r\n   * successfully, a `sessionRestore` event will be fired with the URL the user\r\n   * was at before they were redirected to their Solid Identity Provider.\r\n   * {@see onSessionRestore}\r\n   */\r\n  restorePreviousSession?: boolean;\r\n\r\n  /**\r\n   * Inrupt's Enterprise Solid Server can set a cookie to allow the browser to\r\n   * access private resources on a Pod. In order to mitigate the logout-on-refresh\r\n   * issue on the short term, the server also implemented a session endpoint\r\n   * enabling the client app to know whether the cookie is set. When a user\r\n   * logs in to a server that has that capability enabled, applications that set\r\n   * this option to `true` will be able to make use of it.\r\n   *\r\n   * If your app supports the newest session restore approach, and `restorePreviousSession`\r\n   * is set to true, this option is automatically set to false, but your app will\r\n   * not be logged out when reloaded.\r\n   *\r\n   * `useEssSession` defaults to false and will be removed in the future; to\r\n   * preserve sessions across page reloads, use of `restorePreviousSession` is\r\n   * recommended.\r\n   *\r\n   * @deprecated unreleased\r\n   */\r\n  useEssSession?: boolean;\r\n  /**\r\n   * The URL of the page handling the redirect, including the query\r\n   * parameters  these contain the information to process the login.\r\n   * Note: as a convenience, if no URL value is specified here, we default to\r\n   * using the browser's current location.\r\n   */\r\n  url?: string;\r\n}\r\n\r\nexport async function silentlyAuthenticate(\r\n  sessionId: string,\r\n  clientAuthn: ClientAuthentication,\r\n  session: Session\r\n): Promise<boolean> {\r\n  const storedSessionInfo = await clientAuthn.validateCurrentSession(sessionId);\r\n  if (storedSessionInfo !== null) {\r\n    // It can be really useful to save the user's current browser location,\r\n    // so that we can restore it after completing the silent authentication\r\n    // on incoming redirect. This way, the user is eventually redirected back\r\n    // to the page they were on and not to the app's redirect page.\r\n    window.localStorage.setItem(KEY_CURRENT_URL, window.location.href);\r\n    await clientAuthn.login(\r\n      {\r\n        sessionId,\r\n        prompt: \"none\",\r\n        oidcIssuer: storedSessionInfo.issuer,\r\n        redirectUrl: storedSessionInfo.redirectUrl,\r\n        clientId: storedSessionInfo.clientAppId,\r\n        clientSecret: storedSessionInfo.clientAppSecret,\r\n        tokenType: storedSessionInfo.tokenType ?? \"DPoP\",\r\n      },\r\n      session\r\n    );\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isLoggedIn(\r\n  sessionInfo?: ISessionInfo\r\n): sessionInfo is ISessionInfo & { isLoggedIn: true } {\r\n  return !!sessionInfo?.isLoggedIn;\r\n}\r\n\r\n/**\r\n * A {@link Session} object represents a user's session on an application. The session holds state, as it stores information enabling acces to private resources after login for instance.\r\n */\r\nexport class Session extends EventEmitter {\r\n  /**\r\n   * Information regarding the current session.\r\n   */\r\n  public readonly info: ISessionInfo;\r\n\r\n  private clientAuthentication: ClientAuthentication;\r\n\r\n  private tokenRequestInProgress = false;\r\n\r\n  /**\r\n   * Session object constructor. Typically called as follows:\r\n   *\r\n   * ```typescript\r\n   * const session = new Session();\r\n   * ```\r\n   *\r\n   * See also [getDefaultSession](https://docs.inrupt.com/developer-tools/api/javascript/solid-client-authn-browser/functions.html#getdefaultsession).\r\n   *\r\n   * @param sessionOptions The options enabling the correct instantiation of\r\n   * the session. Either both storages or clientAuthentication are required. For\r\n   * more information, see {@link ISessionOptions}.\r\n   * @param sessionId A string uniquely identifying the session.\r\n   *\r\n   */\r\n  constructor(\r\n    sessionOptions: Partial<ISessionOptions> = {},\r\n    sessionId: string | undefined = undefined\r\n  ) {\r\n    super();\r\n\r\n    if (sessionOptions.clientAuthentication) {\r\n      this.clientAuthentication = sessionOptions.clientAuthentication;\r\n    } else if (sessionOptions.secureStorage && sessionOptions.insecureStorage) {\r\n      this.clientAuthentication = getClientAuthenticationWithDependencies({\r\n        secureStorage: sessionOptions.secureStorage,\r\n        insecureStorage: sessionOptions.insecureStorage,\r\n      });\r\n    } else {\r\n      this.clientAuthentication = getClientAuthenticationWithDependencies({});\r\n    }\r\n\r\n    if (sessionOptions.sessionInfo) {\r\n      this.info = {\r\n        sessionId: sessionOptions.sessionInfo.sessionId,\r\n        isLoggedIn: false,\r\n        webId: sessionOptions.sessionInfo.webId,\r\n      };\r\n    } else {\r\n      this.info = {\r\n        sessionId: sessionId ?? v4(),\r\n        isLoggedIn: false,\r\n      };\r\n    }\r\n\r\n    // When a session is logged in, we want to track its ID in local storage to\r\n    // enable silent refresh. The current session ID specifically stored in 'localStorage'\r\n    // (as opposed to using our storage abstraction layer) because it is only\r\n    // used in a browser-specific mechanism.\r\n    this.on(EVENTS.LOGIN, () =>\r\n      window.localStorage.setItem(KEY_CURRENT_SESSION, this.info.sessionId)\r\n    );\r\n\r\n    this.on(EVENTS.SESSION_EXPIRED, () => this.internalLogout(false));\r\n\r\n    this.on(EVENTS.ERROR, () => this.internalLogout(false));\r\n  }\r\n\r\n  /**\r\n   * Triggers the login process. Note that this method will redirect the user away from your app.\r\n   *\r\n   * @param options Parameter to customize the login behaviour. In particular, two options are mandatory: `options.oidcIssuer`, the user's identity provider, and `options.redirectUrl`, the URL to which the user will be redirected after logging in their identity provider.\r\n   * @returns This method should redirect the user away from the app: it does not return anything. The login process is completed by {@linkcode handleIncomingRedirect}.\r\n   */\r\n  // Define these functions as properties so that they don't get accidentally re-bound.\r\n  // Isn't Javascript fun?\r\n  login = async (options: ILoginInputOptions): Promise<void> => {\r\n    await this.clientAuthentication.login(\r\n      {\r\n        sessionId: this.info.sessionId,\r\n        ...options,\r\n        // Defaults the token type to DPoP\r\n        tokenType: options.tokenType ?? \"DPoP\",\r\n      },\r\n      this\r\n    );\r\n    // `login` redirects the user away from the app,\r\n    // so unless it throws an error, there is no code that should run afterwards\r\n    // (since there is no \"after\" in the lifetime of the script).\r\n    // Hence, this Promise never resolves:\r\n    return new Promise(() => {});\r\n  };\r\n\r\n  /**\r\n   * Fetches data using available login information. If the user is not logged in, this will behave as a regular `fetch`. The signature of this method is identical to the [canonical `fetch`](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API).\r\n   *\r\n   * @param url The URL from which data should be fetched.\r\n   * @param init Optional parameters customizing the request, by specifying an HTTP method, headers, a body, etc. Follows the [WHATWG Fetch Standard](https://fetch.spec.whatwg.org/).\r\n   */\r\n  fetch: typeof fetch = async (url, init) => {\r\n    return this.clientAuthentication.fetch(url, init);\r\n  };\r\n\r\n  /**\r\n   * An internal logout function, to control whether or not the logout signal\r\n   * should be sent, i.e. if the logout was user-initiated or is the result of\r\n   * an external event.\r\n   *\r\n   * @hidden\r\n   */\r\n  private internalLogout = async (emitSignal: boolean): Promise<void> => {\r\n    // Clearing this value means that silent refresh will no longer be attempted.\r\n    // In particular, in the case of a silent authentication error it prevents\r\n    // from getting stuck in an authentication retries loop.\r\n    window.localStorage.removeItem(KEY_CURRENT_SESSION);\r\n    await this.clientAuthentication.logout(this.info.sessionId);\r\n    this.info.isLoggedIn = false;\r\n    if (emitSignal) {\r\n      this.emit(EVENTS.LOGOUT);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Logs the user out of the application. This does not log the user out of their Solid identity provider, and should not redirect the user away.\r\n   */\r\n  logout = async (): Promise<void> => this.internalLogout(true);\r\n\r\n  /**\r\n   * Completes the login process by processing the information provided by the\r\n   * Solid identity provider through redirect.\r\n   *\r\n   * @param options See {@see IHandleIncomingRedirectOptions}.\r\n   */\r\n  handleIncomingRedirect = async (\r\n    inputOptions: string | IHandleIncomingRedirectOptions = {}\r\n  ): Promise<ISessionInfo | undefined> => {\r\n    if (this.info.isLoggedIn) {\r\n      return this.info;\r\n    }\r\n\r\n    if (this.tokenRequestInProgress) {\r\n      return undefined;\r\n    }\r\n    const options =\r\n      typeof inputOptions === \"string\" ? { url: inputOptions } : inputOptions;\r\n    const url = options.url ?? window.location.href;\r\n\r\n    this.tokenRequestInProgress = true;\r\n    const sessionInfo = await this.clientAuthentication.handleIncomingRedirect(\r\n      url,\r\n      this\r\n    );\r\n    if (isLoggedIn(sessionInfo)) {\r\n      this.setSessionInfo(sessionInfo);\r\n      const currentUrl = window.localStorage.getItem(KEY_CURRENT_URL);\r\n      if (currentUrl === null) {\r\n        // The login event can only be triggered **after** the user has been\r\n        // redirected from the IdP with access and ID tokens.\r\n        this.emit(EVENTS.LOGIN);\r\n      } else {\r\n        // If an URL is stored in local storage, we are being logged in after a\r\n        // silent authentication, so remove our currently stored URL location\r\n        // to clean up our state now that we are completing the re-login process.\r\n        window.localStorage.removeItem(KEY_CURRENT_URL);\r\n        this.emit(EVENTS.SESSION_RESTORED, currentUrl);\r\n      }\r\n    } else if (options.restorePreviousSession === true) {\r\n      // Silent authentication happens after a refresh, which means there are no\r\n      // OAuth params in the current location IRI. It can only succeed if a session\r\n      // was previously logged in, in which case its ID will be present with a known\r\n      // identifier in local storage.\r\n      // Check if we have a locally stored session ID...\r\n      const storedSessionId = window.localStorage.getItem(KEY_CURRENT_SESSION);\r\n      // ...if not, then there is no ID token, and so silent authentication cannot happen, but\r\n      // if we do have a stored session ID, attempt to re-authenticate now silently.\r\n      if (storedSessionId !== null) {\r\n        const attemptedSilentAuthentication = await silentlyAuthenticate(\r\n          storedSessionId,\r\n          this.clientAuthentication,\r\n          this\r\n        );\r\n        // At this point, we know that the main window will imminently be redirected.\r\n        // However, this redirect is asynchronous and there is no way to halt execution\r\n        // until it happens precisely. That's why the current Promise simply does not\r\n        // resolve.\r\n        if (attemptedSilentAuthentication) {\r\n          return new Promise(() => {});\r\n        }\r\n      }\r\n    }\r\n    this.tokenRequestInProgress = false;\r\n    return sessionInfo;\r\n  };\r\n\r\n  /**\r\n   * Register a callback function to be called when a user completes login.\r\n   *\r\n   * The callback is called when {@link handleIncomingRedirect} completes successfully.\r\n   *\r\n   * @param callback The function called when a user completes login.\r\n   */\r\n  onLogin(callback: () => unknown): void {\r\n    this.on(EVENTS.LOGIN, callback);\r\n  }\r\n\r\n  /**\r\n   * Register a callback function to be called when a user logs out:\r\n   *\r\n   * @param callback The function called when a user completes logout.\r\n   */\r\n  onLogout(callback: () => unknown): void {\r\n    this.on(EVENTS.LOGOUT, callback);\r\n  }\r\n\r\n  /**\r\n   * Register a callback function to be called when a user logs out:\r\n   *\r\n   * @param callback The function called when an error occurs.\r\n   * @since 1.11.0\r\n   */\r\n  onError(\r\n    callback: (\r\n      error: string | null,\r\n      errorDescription?: string | null\r\n    ) => unknown\r\n  ): void {\r\n    this.on(EVENTS.ERROR, callback);\r\n  }\r\n\r\n  /**\r\n   * Register a callback function to be called when a session is restored.\r\n   *\r\n   * Note: the callback will be called with the saved value of the 'current URL'\r\n   * at the time the session was restored.\r\n   *\r\n   * @param callback The function called when a user's already logged-in session is restored, e.g., after a silent authentication is completed after a page refresh.\r\n   */\r\n  onSessionRestore(callback: (currentUrl: string) => unknown): void {\r\n    this.on(EVENTS.SESSION_RESTORED, callback);\r\n  }\r\n\r\n  /**\r\n   * Register a callback that runs when the session expires and can no longer\r\n   * make authenticated requests, but following a user logout.\r\n   * @param callback The function that runs on session expiration.\r\n   * @since 1.11.0\r\n   */\r\n  onSessionExpiration(callback: () => unknown): void {\r\n    this.on(EVENTS.SESSION_EXPIRED, callback);\r\n  }\r\n\r\n  private setSessionInfo(\r\n    sessionInfo: ISessionInfo & { isLoggedIn: true }\r\n  ): void {\r\n    this.info.isLoggedIn = sessionInfo.isLoggedIn;\r\n    this.info.webId = sessionInfo.webId;\r\n    this.info.sessionId = sessionInfo.sessionId;\r\n    this.info.expirationDate = sessionInfo.expirationDate;\r\n    this.on(EVENTS.SESSION_EXTENDED, (expiresIn: number) => {\r\n      this.info.expirationDate = Date.now() + expiresIn * 1000;\r\n    });\r\n  }\r\n}\r\n"},"lineCount":null}},"error":null,"hash":"9b2d83eb31b7fccacf1d6b2fe3bb4dcd","cacheData":{"env":{}}}